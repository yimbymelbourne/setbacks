<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>setbacks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/intersection-observer-polyfill-1.0.0/intersection-observer.js"></script>
<script src="site_libs/quarto-contrib/scrollama-3.2.0/scrollama.min.js"></script>
<script src="site_libs/quarto-contrib/closeread-0.1.0/closeread.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<meta cr-debug-mode="false">
<meta cr-remove-header-space="true">


<link rel="stylesheet" href="site_libs/quarto-contrib/quarto-project/qmd-lab/closeread/closeread.css">
<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content page-columns page-full column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">setbacks</h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<div class="cr-section column-screen sidebar-left">
<div class="narrative-col">
<div class="trigger new-trigger" data-focus-on="cr-img1">
<div class="narrative">
<div class="inline-logo">
<p><img src="images/logo-green-presents.png" class="img-fluid"></p>
</div>
<section id="whats-ruining-our-citys-architecture-and-how-we-can-fix-it" class="level1">
<h1>What’s ruining our city’s architecture? (And how we can fix it)</h1>
<p>Walking around Melbourne, you might have noticed: there’s a whole lot of buildings with chunks taken out of them.</p>
</section>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-img2">
<div class="narrative">
<p>From Brunswick to Heidelberg to South Melbourne to Richmond, this style of building permeates our streetscapes, with almost every new build taking on this architectural form.</p>
<p><strong>But why?</strong></p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-img3">
<div class="narrative">
<p>Historically, we built our buildings upward.</p>
<p>And not just in Melbourne, either. Cities all around the world are constructed like this.</p>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-img1" class="fill-sticky-col sticky">
<p><img src="images/setbacks2.jpg" class="img-fluid"></p>
</div>
<div id="cr-img2" class="fill-sticky-col sticky">
<p><img src="images/montage.jpg" class="img-fluid"></p>
</div>
<div id="cr-img3" class="inset-sticky-col sticky">
<p><img src="images/old-melbourne.jpg" class="img-fluid"></p>
</div>
</div>
</div>
</div>
<div class="cr-section column-screen overlay-center">
<div class="narrative-col">
<div class="trigger new-trigger" data-focus-on="cr-img4">
<div class="narrative">
<p>From Paris…</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-img5">
<div class="narrative">
<p>…to London…</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-img6">
<div class="narrative">
<p>…to Tokyo.</p>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-img4" class="fill-sticky-col sticky">
<p><img src="images/paris.jpg" class="img-fluid"></p>
</div>
<div id="cr-img5" class="fill-sticky-col sticky">
<p><img src="images/london.jpg" class="img-fluid"></p>
</div>
<div id="cr-img6" class="fill-sticky-col sticky">
<p><img src="images/tokyo.jpg" class="img-fluid"></p>
</div>
</div>
</div>
</div>
<div class="cr-section column-screen sidebar-right">
<div class="narrative-col">
<div class="trigger new-trigger" data-focus-on="cr-img7">
<div class="narrative">
<p>And we didn’t forget how to build straight upward, either.</p>
<p><strong>This is Austin Maynard’s ParkLife, part of Nightingale Village, built in 2022.</strong></p>
<p>It’s one of the most iconic, well-loved, and sustainable new builds in Melbourne.</p>
<p>This is in no small part because of its consistent form: shooting straight up from the earth and toward the sky, it’s modern, striking, and environmentally friendly.</p>
<p>It was also extremely difficult to get planning approval to build.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-img8">
<div class="narrative">
<p><strong>“[ParkLife was] a product of war with the planning process… we wasted a lot of money, council wasted a lot of time—to end up where we started.”</strong></p>
<p>– Andrew Maynard, Architect, at YIMBY Melbourne’s <a href="https://www.youtube.com/watch?v=yLqJwwLpeVc"><em>Unbanning Beauty</em></a></p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-img9">
<div class="narrative">
<p>Most builds do not get as lucky as ParkLife, though.</p>
<p>Instead, they are subjected to an architectural form known as an ‘upper-level setback’, which is codified within planning controls across Melbourne.</p>
<p>This is not just a harmless piece of prescriptive design regulation: <strong>upper-level setbacks are terrible for both environmental sustainability and housing affordability</strong>.</p>
<p>They have almost no benefits, and are making our city worse.</p>
<p>In the context of dual climate and housing crises, it’s time we abolish unnecessary upper-level setbacks.</p>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-img7" class="fill-sticky-col sticky">
<p><img src="images/parklife.jpg" class="img-fluid"></p>
</div>
<div id="cr-img8" class="fill-sticky-col sticky">
<p><img src="images/andrew.jpg" class="img-fluid"></p>
</div>
<div id="cr-img9" class="inset-sticky-col sticky">
<p><img src="images/setbacks-ac-1.jpeg" class="img-fluid"></p>
</div>
</div>
</div>
</div>
<div class="standard-section">
<section id="the-case-against-upper-level-setbacks" class="level1">
<h1>The case against upper-level setbacks</h1>
<p>Upper-level setbacks:</p>
<ol type="1">
<li>increase embodied carbon,</li>
<li>increase operational carbon emissions,</li>
<li>increase construction costs, and</li>
<li>reduce housing supply.</li>
</ol>
<p>We explore each of these issues in some detail below.</p>
<section id="upper-level-setbacks-increase-embodied-carbon" class="level3">
<h3 class="anchored" data-anchor-id="upper-level-setbacks-increase-embodied-carbon">1. Upper-level setbacks increase embodied carbon</h3>
<p>Researchers from the University of Toronto found that <a href="https://onlinelibrary.wiley.com/doi/epdf/10.1111/jiec.13461">almost three quarters of the embodied carbon</a> in a given build came from reinforced concrete, slabs, and drop panels.</p>
<div class="inset-standard-img">
<p><img src="images/emissions.png" class="img-fluid"></p>
</div>
<p>“<strong>Design choices can yield large reductions in emissions</strong>,” write Rankin et al.&nbsp;in the Journal of Industrial Ecology.</p>
<p>In order to reduce embodied carbon, the researchers recommended the removal of setbacks.</p>
<p>Concrete slab volume, they write, “is a major driver of concrete emissions and could be reduced by building without [setbacks], which increase concrete load through large transfer slabs while reducing usable space.”</p>
<p>Also in Toronto, Half Climate Design <a href="https://drive.google.com/file/d/1abTbNfkZHWNJ9lPGDY5yR0sxNdOCMoge/view">developed alternate designs for two medium-density projects</a> affected by upper-level setback controls.</p>
<p>The analysis demonstrated that <strong>the removal of setbacks would save between 10 and 17 kg of carbon per square metre built</strong>—even without moving to the more sustainable materials this alternative design would enable.</p>
</section>
</section>
<section id="half-img" class="level1">
<h1>half img</h1>
<p>In addition to all of the above, setbacks also increase a building’s surface area and exposure to the elements.</p>
<p>This necessitates more thermal treatment and waterproofing, which is resource intensive and increases lifetime inefficiency of the building.</p>
<p>Which leads nicely to our next point.</p>
<section id="upper-level-setbacks-increase-operational-carbon-emissions" class="level3">
<h3 class="anchored" data-anchor-id="upper-level-setbacks-increase-operational-carbon-emissions">2. Upper-level setbacks increase operational carbon emissions</h3>
<p>Because setbacks require the extension of uncovered continuous floor slabs, buildings <a href="https://perkinswill.com/report-thermally-broken-balconies/">lose thermal efficiency due to heat transfer through exposed areas</a> and structural concrete lacking shade from overhead balconies.</p>
<div class="inset-standard-img">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/thermal-bridge.png" class="img-fluid figure-img"></p>
<figcaption>Thermal bridging from continuous floor slabs cause heat loss.</figcaption>
</figure>
</div>
</div>
<p>This increases heating and cooling costs for the building throughout its lifetime, and increases electricity bills for occupants.</p>
<p>As a fun bonus, due to the temperature of continuous floor slabs, setbacks also increase the risk of mould and condensation inside apartments. Thank you planners, very cool!</p>
</section>
<section id="upper-level-setbacks-increase-construction-costs" class="level3">
<h3 class="anchored" data-anchor-id="upper-level-setbacks-increase-construction-costs">3. Upper-level setbacks increase construction costs</h3>
<p>Buildings with a traditional “boxy” shape <a href="https://www.theurbanist.org/2018/08/22/in-praise-of-dumb-boxes/">are simpler—and cheaper—to build and maintain</a>, while more complex built forms are the exact opposite.</p>
<div class="inset-standard-img">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/transfer-slab.png" class="img-fluid figure-img"></p>
<figcaption>Upper-level setbacks require increased concrete use.</figcaption>
</figure>
</div>
</div>
<p>Upper-level setback controls raise the per-dwelling costs, which are then passed on in the sell prices of apartments within a given project.</p>
<p>This reduces project viability, and throws up yet another barrier to the increased housing supply our city needs.</p>
</section>
<section id="upper-level-setbacks-reduce-housing-supply" class="level3">
<h3 class="anchored" data-anchor-id="upper-level-setbacks-reduce-housing-supply">4. Upper-level setbacks reduce housing supply</h3>
<p>Moreover, setback requirements force developments to deliver less floor space—and therefore less housing.</p>
<p>How this happens is obvious when you look at a building with setbacks—all that empty space could have been more homes where people want to live.</p>
<p>The <a href="(https://drive.google.com/file/d/1abTbNfkZHWNJ9lPGDY5yR0sxNdOCMoge/view)">Half Climate Design alternate designs</a> found that case study projects would have delivered 20% to 70% more housing if setbacks weren’t enforced.</p>
<div class="inset-standard-img">
<p><img src="images/counterfactuals.png" class="img-fluid"></p>
</div>
<div class="inset-standard-img">
<table class="caption-top table">
<tbody>
<tr class="odd">
<td></td>
<td><strong>With setbacks</strong></td>
<td><strong>No setbacks</strong></td>
</tr>
<tr class="even">
<td>1100 Kingston Road</td>
<td>146 units</td>
<td>254 units</td>
</tr>
<tr class="odd">
<td>2803 Dundas Street West</td>
<td>92 units</td>
<td>113 units</td>
</tr>
</tbody>
</table>
</div>
<p>The additional yield would enable housing projects to deliver more bedrooms, more homes, and more housing diversity to neighbourhoods across our city.</p>
<p>But all this is precluded by the planning system’s harmful insistence on enforcing upper-level setbacks.</p>
</section>
</section>
</div>
<div class="cr-section column-screen overlay-center">
<div class="narrative-col">
<div class="trigger new-trigger" data-focus-on="cr-why-img1">
<div class="narrative">
<p>The question is—if upper-level setbacks are so obviously bad, then why are they such a prominent feature of anglospheric planning systems?</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-why-img2">
<div class="narrative">
<p>Well, beyond standard conservative planner arguments of “this is how we’ve done it for decades”, there <em>are</em> some arguments for upper-level setbacks.</p>
<p>They’re just not very good.</p>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-why-img1" class="fill-sticky-col sticky">
<p><img src="images/paris.jpg" class="img-fluid"></p>
</div>
<div id="cr-why-img2" class="fill-sticky-col sticky">
<p><img src="images/london.jpg" class="img-fluid"></p>
</div>
</div>
</div>
</div>
<section id="the-shaky-case-for-upper-level-setbacks" class="level1 standard-section">
<h1>The (shaky) case for upper-level setbacks</h1>
<p>Upper-level setbacks:</p>
<ol type="1">
<li>Reduce wind tunnelling (but only on very tall buildings)</li>
<li>Increase solar access (at the cost of shade and safety)</li>
<li>Reduce ‘visual bulk’ (this is not a real thing)</li>
</ol>
<p>Again, we explore each of these points briefly below.</p>
<section id="upper-level-setbacks-reduce-wind-tunnelling-on-buildings-well-over-20-storeys" class="level3">
<h3 class="anchored" data-anchor-id="upper-level-setbacks-reduce-wind-tunnelling-on-buildings-well-over-20-storeys">Upper-level setbacks reduce wind tunnelling (on buildings well over 20 storeys)</h3>
<p>Many advocates for the current setback regime argue that they play a vital role in preventing urban canyoning or wind tunnelling.</p>
<p>The thing is—most evidence around wind tunnelling focuses on buildings above 20 storeys tall. There is little evidence that wind tunnelling is a major issue at low heights like those within Victorian planning controls.</p>
<p>Where wind tunnelling is a concern, it can be adequately resolved without upper-level setbacks, through measures such as urban tree planting and the separation of buildings at the ground level.</p>
<p>Meanwhile, our city’s setback requirements sometimes start as low as 2 storeys, and apply to buildings well below 20 storeys total height.</p>
</section>
<section id="upper-level-setbacks-increase-solar-access-at-the-cost-of-shade-and-safety" class="level3">
<h3 class="anchored" data-anchor-id="upper-level-setbacks-increase-solar-access-at-the-cost-of-shade-and-safety">Upper-level setbacks increase solar access (at the cost of shade and safety)</h3>
<p>Another notable argument in favour of upper-level setbacks is to do with overshadowing and sunlight. Indeed, current controls aim to maximise the amount of sunlight that hits our streets.</p>
<p>This aim, however, is falling under greater scrutiny in a warming world, where urban heat is considered a great threat to public health.</p>
<p>In a city like Melbourne, infamous for its cloudy weather, should overshadowing be our main concern, given the high cost of setbacks, and the fact that for a majority of the year the sunlight is diffuse anyway?</p>
<p>Indeed, recessing all our buildings comes at a great cost, including forgoing the benefits of shade for pedestrians, all the while disconnecting residents from their broader streetscape and neighbourhood, cutting off their connection from others and completely nullifying the safety benefits of passive surveillance.</p>
</section>
<section id="upper-level-setbacks-reduce-visual-bulk-this-is-not-a-real-thing" class="level3">
<h3 class="anchored" data-anchor-id="upper-level-setbacks-reduce-visual-bulk-this-is-not-a-real-thing">Upper-level setbacks reduce ‘visual bulk’ (this is not a real thing)</h3>
<p>Let us be completely clear: visual bulk is not a real thing. It is a term invented by the planning system, and has no evidentiary basis to back it up.</p>
<p>And yet it is the governing reason our system requires upper-level setbacks.</p>
<p>The two concerns above—wind tunnelling and solar access—could both be confronted in large part through ground-level setbacks.</p>
<blockquote class="blockquote">
<p>IMG</p>
</blockquote>
<p>However, the planning system does not consider ground-level setbacks to be a substitute for upper-level setbacks.</p>
<p>If you set your building back at the ground level, you cannot just build straight upward. You then have to also implement an upper-level setback.</p>
<p>Why? Because of “visual bulk” which, again, we have to stress, is not a real thing.</p>
</section>
</section>
<div class="cr-section column-screen sidebar-left">
<div class="narrative-col">
<div class="trigger new-trigger" data-focus-on="cr-final">
<section id="its-time-to-fight-against-bad-rules" class="level1 narrative">
<h1>It’s time to fight against bad rules</h1>
<p>The State Government has just released draft plans for ten Activity Centres across Melbourne. All of these Centres have upper-level setbacks codified within their plans, indicating that these terrible, destructive controls are currently slated to be a feature of the new Plan for Victoria.</p>
<p><strong>This is unacceptable.</strong></p>
<p>There is no justification for maintaining this outdated and debunked design control. It makes housing more expensive, our buildings less sustainable, and our streetscapes uglier.</p>
<p>With your help, we can put this to an end.</p>
<p>{sign our petition to end upper-level setbacks}</p>
</section>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">

</div>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>